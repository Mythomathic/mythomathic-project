<!DOCTYPE html>
<html lang="ca"> 
<head> 
  <meta charset="UTF-8"> 
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
  <title>Realithia - Mythomathic</title> 
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet"> 
  <link rel="stylesheet" href="realithia.css"> 
</head> 

<body> 
<header> 
  <button class="back-button" onclick="goTo('map.html')">‚¨Ö Mapa</button> 
  <div class="title-center"> 
    <img src="R_Title.png" alt="Realithia" class="title-img"> 
  </div> 
  <div class="header-buttons"> 
    <button onclick="openLore()">üìú Lore</button> 
    <button onclick="toggleMenu()">‚ò∞ Men√∫</button> 
  </div> 
  <nav id="menu"> 
    <ul> 
      <li onclick="goTo('map.html')">Mapa</li> 
      <li onclick="goTo('perfil.html')">Perfil</li> 
      <li onclick="goTo('config.html')">Configuraci√≥</li> 
      <li onclick="goTo('sobremi.html')">Sobre mi</li> 
      <li onclick="goTo('contacte.html')">Contacte</li> 
    </ul> 
  </nav> 
</header> 

<main class="dimension-container"> 
  <aside class="categories"> 
    <button onclick="showSymbols('reals')">Nombres Reals</button> 
    <button onclick="showSymbols('potencies')">Pot√®ncies</button> 
    <button onclick="showSymbols('logaritmes')">Logaritmes</button> 
    <button onclick="showSymbols('radicals')">Radicals</button> 
  </aside> 

  <div class="symbols">
    <!-- Nombres reals -->
    <img src="icon-re.png" alt="Reals" class="symbol" data-cat="reals"
        style="top: 180px; left: 320px;" onclick="openPopup('Intervals i valors absoluts')">
    <img src="icon-re.png" alt="Reals" class="symbol" data-cat="reals"
        style="top: 530px; left: 680px;" onclick="openPopup('Recta real i conjunts')">
    <img src="icon-re.png" alt="Reals" class="symbol" data-cat="reals"
        style="top: 600px; left: 200px;" onclick="openPopup('Operacions amb nombres reals')">

    <!-- Pot√®ncies -->
    <img src="icon-re.png" alt="Pot√®ncies" class="symbol" data-cat="potencies"
        style="top: 220px; left: 680px;" onclick="openPopup('Propietats de les pot√®ncies')">
    <img src="icon-re.png" alt="Pot√®ncies" class="symbol" data-cat="potencies"
        style="top: 420px; left: 560px;" onclick="openPopup('Notaci√≥ cient√≠fica')">
    <img src="icon-re.png" alt="Pot√®ncies" class="symbol" data-cat="potencies"
        style="top: 600px; left: 960px;" onclick="openPopup('Exponents negatius i fraccionaris')">

    <!-- Radicals -->
    <img src="icon-re.png" alt="Radicals" class="symbol" data-cat="radicals"
        style="top: 350px; left: 940px;" onclick="openPopup('Simplificaci√≥ de radicals')">
    <img src="icon-re.png" alt="Radicals" class="symbol" data-cat="radicals"
        style="top: 510px; left: 260px;" onclick="openPopup('Operacions amb radicals')">
    <img src="icon-re.png" alt="Radicals" class="symbol" data-cat="radicals"
        style="top: 630px; left: 760px;" onclick="openPopup('Racionalitzaci√≥ del denominador')">

   <!-- Logaritmes -->
    <img src="icon-re.png" alt="Logaritmes" class="symbol" data-cat="logaritmes"
        style="top: 300px; left: 620px;" onclick="openPopup('Definici√≥ i base dels logaritmes')">
    <img src="icon-re.png" alt="Logaritmes" class="symbol" data-cat="logaritmes"
        style="top: 540px; left: 520px;" onclick="openPopup('Propietats dels logaritmes')">
    <img src="icon-re.png" alt="Logaritmes" class="symbol" data-cat="logaritmes"
        style="top: 450px; left: 880px;" onclick="openPopup('Canvis de base i equacions logar√≠tmiques')"> 
  </div> 
</main> 

<!-- POPUP LORE --> 
<div id="lorePopup" class="popup"> 
  <div class="popup-content lore-content"> 
    <span class="close" onclick="closeLore()">&times;</span>
    <img src="lore_R.png" alt="Pergam√≠" class="scroll-img"> 
  </div> 
</div> 

<!-- POPUP EXERCICI -->
<div id="exercisePopup" class="popup">
  <div class="popup-content">
    <span class="close" onclick="closePopup()">&times;</span>
    <h2 id="exerciseTitle"></h2>
    <div id="exerciseContent"></div>
  </div>
</div>

<!-- CHATBOT -->
<div id="capy-toggle">
  <img src="capy2.png" alt="Capy">
</div>

<div id="capy-chat" class="hidden">
  <div class="capy-header">
    <img src="capy2.png" alt="Capy">
    <span>Capy - Guia</span>
  </div>
  <div id="capy-messages"></div>
  <input id="capy-input" placeholder="Pregunta a Capy...">
  <div id="capy-thinking" class="hidden">
  <span class="dot"></span>
  <span class="dot"></span>
  <span class="dot"></span>
</div>
</div>

<script> 
function toggleMenu() { 
  document.getElementById('menu').classList.toggle('active'); 
} 

function goTo(page) { 
  window.location.href = page; 
} 

function openLore() { 
  document.getElementById("lorePopup").style.display = "flex"; 
} 



// funci√≥ existent: tanca el popup lore
  function closeLore(){
    const lp = document.getElementById("lorePopup");
    if(lp) lp.style.display = "none";
  }

  // fallback: assegurem l'event si l'atribut onclick no s'executa per algun motiu
  document.addEventListener("DOMContentLoaded", () => {
    const closeBtn = document.querySelector(".lore-content .close");
    if(closeBtn){
      closeBtn.addEventListener("click", closeLore);
    }
    // Tamb√© fem que fer click a la capa fosca tanqui el popup (opcional)
    const lorePopup = document.getElementById("lorePopup");
    if(lorePopup){
      lorePopup.addEventListener("click", (e) => {
        if(e.target === lorePopup) closeLore(); // nom√©s si cliques fora del contingut
      });
    }
  });

function showSymbols(type) {
  document.querySelectorAll(".symbol").forEach(el => el.style.display = "none");
  document.querySelectorAll(".symbol[data-cat='"+type+"']").forEach(el => el.style.display = "block");
}

document.addEventListener("DOMContentLoaded", () => {
  showSymbols("reals");
});

// ======= POPUP Exercicis =======
function closePopup() {
  document.getElementById("exercisePopup").style.display = "none";
}


/* ---------- CHATBOT ---------- */
const capyToggle = document.getElementById("capy-toggle");
const capyChat = document.getElementById("capy-chat");
const capyInput = document.getElementById("capy-input");
const capyMessages = document.getElementById("capy-messages");

capyToggle.onclick = () => capyChat.classList.toggle("hidden");

capyInput.addEventListener("keypress", async (e) => {
  if (e.key === "Enter" && capyInput.value.trim()) {
    const msg = capyInput.value.trim();
    capyMessages.innerHTML += `<p><b>Tu:</b> ${msg}</p>`;
    capyInput.value = "";

    // MOSTREM punts de pensament
    const thinking = document.getElementById("capy-thinking");
    thinking.classList.remove("hidden");

    // Enviem el missatge al servidor
    try {
      const res = await fetch('https://mythomathic-server.onrender.com/api/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: msg }),
      });

      const data = await res.json();

      // OCULTEM punts quan arriba la resposta
      thinking.classList.add("hidden");

      // Afegim missatge de Capy amb s√≠mbols matem√†tics
      capyMessages.innerHTML += `<p><b>Capy:</b> ${data.reply}</p>`;
      MathJax.typesetPromise();
      capyMessages.scrollTop = capyMessages.scrollHeight;

    } catch (err) {
      thinking.classList.add("hidden"); // assegurem amagar punts si hi ha error
      capyMessages.innerHTML += `<p><b>Capy:</b> Ups! Hi ha hagut un error al enviar el missatge.</p>`;
      capyMessages.scrollTop = capyMessages.scrollHeight;
    }
  }
});



// Diccionari d‚Äôexercicis

const exercises = {
  // --- Nombres Reals ---
  "Intervals i valors absoluts": () => generateIntervalsExercise(),
  "Recta real i conjunts": () => generateSetsExercise(),
  "Operacions amb nombres reals": () => generateClassificationExercise(),

  // --- Pot√®ncies ---
  "Propietats de les pot√®ncies": () => generatePowerPropertiesExercise(),
  "Notaci√≥ cient√≠fica": () => {
    if (Math.random() < 0.5) {
      generateScientificNotationExercise();
    } else {
      generateScientificConversionExercise();
    }
  },
  "Exponents negatius i fraccionaris": () => generateExponentsExercise(),

  // --- Logaritmes ---

  "Definici√≥ i base dels logaritmes": () => generateLogDefinitionExercise(),
  "Propietats dels logaritmes": () => generateLogPropertiesExercise(),
  "Canvis de base i equacions logar√≠tmiques": () => generateLogEquationsExercise(),

  // --- Radicals ---
  "Simplificaci√≥ de radicals": () => generateRadicalSimplifyExercise(),
  "Operacions amb radicals": () => generateRadicalOperationsExercise(),
  "Racionalitzaci√≥ del denominador": () => generateRadicalRationalizeExercise()
};



function openPopup(title) {
  document.getElementById("exerciseTitle").textContent = title;
  document.getElementById("exercisePopup").style.display = "flex";
  if (exercises[title]) {
    document.getElementById("exerciseContent").innerHTML = "";
    exercises[title]();
  } else {
    document.getElementById("exerciseContent").innerHTML = "<p>Encara no hi ha exercicis disponibles per aquest apartat.</p>";
  }
}

/* ===================== NOMBRES REALS ===================== */

// Exemple intervals
function generateIntervalsExercise() {
  const container = document.getElementById("exerciseContent");
  const examples = [
    {ineq: "‚àí2 < x ‚â§ 4", ans: "(-2,4]"},
    {ineq: "6 < x < 10", ans: "(6,10)"},
    {ineq: "x ‚â§ 5", ans: "(-‚àû,5]"},
    {ineq: "‚àí3 < x", ans: "(-3,‚àû)"},
    {ineq: "‚àí4 ‚â§ x ‚â§ 3", ans: "[-4,3]"}
  ];
  const ex = examples[Math.floor(Math.random()*examples.length)];

  container.innerHTML = `
    <p>Escriviu l‚Äôinterval que correspon a la desigualtat seg√ºent:</p>
    <p><b>${ex.ineq}</b></p>
    <input type="text" id="answer" placeholder="Ex: (-2,4]">
    <button onclick="checkAnswer('${ex.ans}')">Comprovar</button>
    <button onclick="generateIntervalsExercise()">Nova activitat</button>
    <p id="feedback"></p>
  `;
}

// Exemple conjunts i recta real
function generateSetsExercise() {
  const container = document.getElementById("exerciseContent");
  const examples = [
    {interval: "[1,7]", ans: "1 ‚â§ x ‚â§ 7"},
    {interval: "(-2,3]", ans: "‚àí2 < x ‚â§ 3"},
    {interval: "[-2,2)", ans: "‚àí2 ‚â§ x < 2"},
    {interval: "(‚àí‚àû,‚àí7]", ans: "x ‚â§ ‚àí7"}
  ];
  const ex = examples[Math.floor(Math.random()*examples.length)];

  container.innerHTML = `
    <p>Escriu en forma de desigualtat l‚Äôinterval seg√ºent:</p>
    <p><b>${ex.interval}</b></p>
    <input type="text" id="answer" placeholder="Ex: 1 ‚â§ x ‚â§ 7">
    <button onclick="checkAnswer('${ex.ans}')">Comprovar</button>
    <button onclick="generateSetsExercise()">Nova activitat</button>
    <p id="feedback"></p>
  `;
}

// Classificar nombres (racionals / irracionals)
function generateClassificationExercise() {
  const container = document.getElementById("exerciseContent");
  const numbers = [
    {num: "2.3333...", ans: "Racional"},
    {num: "‚àö2", ans: "Irracional"},
    {num: "7/5", ans: "Racional"},
    {num: "œÄ", ans: "Irracional"},
    {num: "‚àö9", ans: "Racional"},
    {num: "1+‚àö3", ans: "Irracional"}
  ];
  const subset = numbers.sort(() => 0.5 - Math.random()).slice(0,4);

  container.innerHTML = `<p>Classifica cada nombre com a Racional o Irracional:</p>`;

  subset.forEach((item, i) => {
    container.innerHTML += `
      <div>
        <b>${item.num}</b> ‚Üí 
        <select id="sel${i}">
          <option value="">-- Tria --</option>
          <option value="Racional">Racional</option>
          <option value="Irracional">Irracional</option>
        </select>
        <span id="fb${i}"></span>
      </div>
    `;
  });

  container.innerHTML += `
    <button onclick="checkClassification([${subset.map(x=>`'${x.ans}'`).join(",")}])">Comprovar</button>
    <button onclick="generateClassificationExercise()">Nova activitat</button>
  `;
}

function checkClassification(correctAnswers) {
  correctAnswers.forEach((ans, i) => {
    const val = document.getElementById("sel"+i).value;
    const fb = document.getElementById("fb"+i);
    fb.textContent = val === ans ? "‚úîÔ∏è" : "‚ùå";
    fb.style.color = val === ans ? "lightgreen" : "red";
  });
}

/* ===================== POT√àNCIES ===================== */

// Propietats de les pot√®ncies
function generatePowerPropertiesExercise() {
  const container = document.getElementById("exerciseContent");
  const examples = [
    {expr: "a¬≥ ¬∑ a‚Åµ", ans: "a^8"},
    {expr: "(b‚Å¥)¬≤", ans: "b^8"},
    {expr: "c‚Å∑ / c¬≥", ans: "c^4"},
    {expr: "x¬≤ ¬∑ x¬≥ / x", ans: "x^4"}
  ];
  const ex = examples[Math.floor(Math.random()*examples.length)];

  container.innerHTML = `
    <p>Aplicant les propietats de les pot√®ncies, expressa com una sola pot√®ncia:</p>
    <p><b>${ex.expr}</b></p>
    <input type="text" id="answer" placeholder="Ex: a^8">
    <button onclick="checkAnswer('${ex.ans}')">Comprovar</button>
    <button onclick="generatePowerPropertiesExercise()">Nova activitat</button>
    <p id="feedback"></p>
  `;
}

// Notaci√≥ cient√≠fica (operacions)
function generateScientificNotationExercise() {
  const container = document.getElementById("exerciseContent");
  const examples = [
    {expr: "3.5¬∑10^3 + 2.4¬∑10^2", ans: "3.74¬∑10^3"},
    {expr: "7.3¬∑10^4 ¬∑ 5.25¬∑10^-3", ans: "3.8325¬∑10^2"},
    {expr: "8.3¬∑10^6 : 5.37¬∑10^2", ans: "1.545¬∑10^4"}
  ];
  const ex = examples[Math.floor(Math.random()*examples.length)];

  container.innerHTML = `
    <p>Feu l‚Äôoperaci√≥ en notaci√≥ cient√≠fica:</p>
    <p><b>${ex.expr}</b></p>
    <input type="text" id="answer" placeholder="Ex: 3.74¬∑10^3">
    <button onclick="checkAnswer('${ex.ans}')">Comprovar</button>
    <button onclick="generateScientificNotationExercise()">Nova activitat</button>
    <p id="feedback"></p>
  `;
}

// Notaci√≥ cient√≠fica (transformar nombres)
function generateScientificConversionExercise() {
  const container = document.getElementById("exerciseContent");
  const examples = [
    {num: "1200000", ans: "1.2¬∑10^6"},
    {num: "0.000000024", ans: "2.4¬∑10^-8"},
    {num: "3400540000", ans: "3.40054¬∑10^9"}
  ];
  const ex = examples[Math.floor(Math.random()*examples.length)];

  container.innerHTML = `
    <p>Escriu amb notaci√≥ cient√≠fica:</p>
    <p><b>${ex.num}</b></p>
    <input type="text" id="answer" placeholder="Ex: 1.2¬∑10^6">
    <button onclick="checkAnswer('${ex.ans}')">Comprovar</button>
    <button onclick="generateScientificConversionExercise()">Nova activitat</button>
    <p id="feedback"></p>
  `;
}

// Exponents negatius i fraccionaris
function generateExponentsExercise() {
  const container = document.getElementById("exerciseContent");
  const examples = [
    {expr: "x^-2", ans: "1/x^2"},
    {expr: "a^(1/2)", ans: "‚àöa"},
    {expr: "b^(3/2)", ans: "b‚àöb"},
    {expr: "1/x^-3", ans: "x^3"}
  ];
  const ex = examples[Math.floor(Math.random()*examples.length)];

  container.innerHTML = `
    <p>Simplifica l‚Äôexpressi√≥ amb exponents negatius o fraccionaris:</p>
    <p><b>${ex.expr}</b></p>
    <input type="text" id="answer" placeholder="Ex: 1/x^2">
    <button onclick="checkAnswer('${ex.ans}')">Comprovar</button>
    <button onclick="generateExponentsExercise()">Nova activitat</button>
    <p id="feedback"></p>
  `;
}

/* ===================== LOGARITMES ===================== */

// Definici√≥ i base
function generateLogDefinitionExercise() {
  const container = document.getElementById("exerciseContent");
  const examples = [
    {expr: "log2 64", ans: "6"},
    {expr: "log3 81", ans: "4"},
    {expr: "log5 1/125", ans: "‚àí3"},
    {expr: "log8 64", ans: "2"},
    {expr: "log12 12", ans: "1"},
    {expr: "log25 1", ans: "0"},
    {expr: "log2 0.5", ans: "‚àí1"},
    {expr: "log5 0.2", ans: "‚àí1"},
    {expr: "log3 1/9", ans: "‚àí2"},
    {expr: "log6 1/216", ans: "‚àí3"}
  ];
  const ex = examples[Math.floor(Math.random()*examples.length)];

  container.innerHTML = `
    <p>Calcula aquest logaritme a partir de la definici√≥:</p>
    <p><b>${ex.expr}</b></p>
    <input type="text" id="answer" placeholder="Ex: 3">
    <button onclick="checkAnswer('${ex.ans}')">Comprovar</button>
    <button onclick="generateLogDefinitionExercise()">Nova activitat</button>
    <p id="feedback"></p>
  `;
}

// Propietats dels logaritmes
function generateLogPropertiesExercise() {
  const container = document.getElementById("exerciseContent");
  const examples = [
    {expr: "log2 32^7", ans: "35"},
    {expr: "log7 49^77", ans: "154"},
    {expr: "log(1/2) 8^15", ans: "-45"},
    {expr: "log(1/3) 27^(1/9)", ans: "-1/3"},
    {expr: "log2 ‚àö2", ans: "1/2"},
    {expr: "log2 (‚àö8 ¬∑ 32)", ans: "11/2"},
    {expr: "log3 (‚àõ9 / ‚àö27)", ans: "0"}
  ];
  const ex = examples[Math.floor(Math.random()*examples.length)];

  container.innerHTML = `
    <p>Calcula aplicant les propietats dels logaritmes:</p>
    <p><b>${ex.expr}</b></p>
    <input type="text" id="answer" placeholder="Ex: 35">
    <button onclick="checkAnswer('${ex.ans}')">Comprovar</button>
    <button onclick="generateLogPropertiesExercise()">Nova activitat</button>
    <p id="feedback"></p>
  `;
}

// Canvi de base i equacions
function generateLogEquationsExercise() {
  const container = document.getElementById("exerciseContent");
  const examples = [
    {expr: "log5 20 (usa canvi de base amb log10)", ans: "log(20)/log(5)"},
    {expr: "log2 50 (usa canvi de base amb log10)", ans: "log(50)/log(2)"},
    {expr: "Resol l‚Äôequaci√≥: log2 x = 5", ans: "32"},
    {expr: "Resol l‚Äôequaci√≥: log3 x = ‚àí2", ans: "1/9"},
    {expr: "Resol l‚Äôequaci√≥: log10 x = 0", ans: "1"}
  ];
  const ex = examples[Math.floor(Math.random()*examples.length)];

  container.innerHTML = `
    <p><b>${ex.expr}</b></p>
    <input type="text" id="answer" placeholder="Resposta">
    <button onclick="checkAnswer('${ex.ans}')">Comprovar</button>
    <button onclick="generateLogEquationsExercise()">Nova activitat</button>
    <p id="feedback"></p>
  `;
}

/* ===================== RADICALS ===================== */

// Simplificaci√≥ de radicals
function generateRadicalSimplifyExercise() {
  const container = document.getElementById("exerciseContent");
  const examples = [
    {expr: "‚àö121", ans: "11"},
    {expr: "¬≥‚àö27", ans: "3"},
    {expr: "‚àö(a¬≤+18a+81)", ans: "a+9"},
    {expr: "10‚àö(11^12)", ans: "11"},
    {expr: "¬≥‚àö(27z-108)", ans: "3‚àö(z-4)"}
  ];
  const ex = examples[Math.floor(Math.random()*examples.length)];

  container.innerHTML = `
    <p>Simplifica el radical:</p>
    <p><b>${ex.expr}</b></p>
    <input type="text" id="answer" placeholder="Ex: 11">
    <button onclick="checkAnswer('${ex.ans}')">Comprovar</button>
    <button onclick="generateRadicalSimplifyExercise()">Nova activitat</button>
    <p id="feedback"></p>
  `;
}

// Operacions amb radicals
function generateRadicalOperationsExercise() {
  const container = document.getElementById("exerciseContent");
  const examples = [
    {expr: "‚àö2 + ‚àö2", ans: "2‚àö2"},
    {expr: "2‚àö3 - ‚àö3", ans: "‚àö3"},
    {expr: "‚àö5 ¬∑ ‚àö5", ans: "5"},
    {expr: "‚àö18 / ‚àö2", ans: "3"}
  ];
  const ex = examples[Math.floor(Math.random()*examples.length)];

  container.innerHTML = `
    <p>Resol l‚Äôoperaci√≥ amb radicals:</p>
    <p><b>${ex.expr}</b></p>
    <input type="text" id="answer" placeholder="Ex: 2‚àö2">
    <button onclick="checkAnswer('${ex.ans}')">Comprovar</button>
    <button onclick="generateRadicalOperationsExercise()">Nova activitat</button>
    <p id="feedback"></p>
  `;
}

// Racionalitzaci√≥ del denominador
function generateRadicalRationalizeExercise() {
  const container = document.getElementById("exerciseContent");
  const examples = [
    {expr: "6/‚àö2", ans: "3‚àö2"},
    {expr: "‚àö(2/9)", ans: "‚àö2/3"},
    {expr: "‚àö3/‚àö8", ans: "‚àö6/4"},
    {expr: "9‚àö6 / 4‚àö3", ans: "(9‚àö2)/4"}
  ];
  const ex = examples[Math.floor(Math.random()*examples.length)];

  container.innerHTML = `
    <p>Racionalitza el denominador i simplifica si escau:</p>
    <p><b>${ex.expr}</b></p>
    <input type="text" id="answer" placeholder="Ex: 3‚àö2">
    <button onclick="checkAnswer('${ex.ans}')">Comprovar</button>
    <button onclick="generateRadicalRationalizeExercise()">Nova activitat</button>
    <p id="feedback"></p>
  `;
}


/* ===================== FEEDBACK GENERAL ===================== */
function checkAnswer(correct) {
  const userAns = document.getElementById("answer").value.trim();
  const fb = document.getElementById("feedback");
  if (userAns === correct) {
    fb.textContent = "Correcte! ‚úîÔ∏è";
    onExerciseCorrect();
  } else {
    fb.textContent = "Incorrecte ‚ùå (resposta esperada: " + correct + ")";
  }
}


// ================== EXPERI√àNCIA =====================
let correctExercises=0;
let xp=parseInt(localStorage.getItem("xp"))||0;
let level=parseInt(localStorage.getItem("level"))||1;
let xpGainBase=50;

function addXP(amount){
  xp+=amount;
  const xpMax=level*100;
  if(xp>=xpMax){ xp-=xpMax; level++; gainTitle(level); }
  localStorage.setItem("xp",xp);
  localStorage.setItem("level",level);
  alert(`üèÖ Has guanyat ${amount} XP! (Nivell actual: ${level})`);
}
function gainTitle(level){
  const titles={
    1:"Custodi del Flux",2:"Guardi√† del Patr√≥",3:"Savi d‚ÄôEkuatia",
    4:"Somniador de Tangentia",5:"Vigilant de Complexia",
    6:"Cercador de Functonia",7:"Mestre de Derivalia"
  };
  const newTitle=titles[level]||`Aventurer Nivell ${level}`;
  alert(`‚ú® Has pujat de nivell! Nou t√≠tol: ${newTitle}`);
  localStorage.setItem("title",newTitle);
}
function onExerciseCorrect(){
  correctExercises++;
  if(correctExercises%5===0){
    const earnedXP=Math.max(10,xpGainBase-(level-1)*5);
    addXP(earnedXP);
  }
}
</script>


<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-firestore.js";

// üîπ Configuraci√≥ Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDPVUQZXaSAARwROsDgvlohMvB-esYvMrA",
  authDomain: "mythomathic.firebaseapp.com",
  projectId: "mythomathic",
  storageBucket: "mythomathic.firebasestorage.app",
  messagingSenderId: "396574593247",
  appId: "1:396574593247:web:5b7f02c53de5613eda996a"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser;

// üîπ Quan l‚Äôusuari est√† autenticat, recuperem el seu XP actual
onAuthStateChanged(auth, async (user) => {
  if (user) {
    currentUser = user;
    const ref = doc(db, "users", user.uid);
    const snapshot = await getDoc(ref);
    if (snapshot.exists()) {
      const data = snapshot.data();
      xp = data.xp || 0;
      level = data.level || 1;
      localStorage.setItem("xp", xp);
      localStorage.setItem("level", level);
    }
  } else {
    console.warn("Usuari no autenticat ‚Äî XP nom√©s local.");
  }
});

// üîπ Funci√≥ per sincronitzar XP amb la base de dades
async function updateXPInDB(newXP, newLevel) {
  if (!currentUser) return;
  try {
    await updateDoc(doc(db, "users", currentUser.uid), {
      xp: newXP,
      level: newLevel
    });
    console.log("‚úÖ XP actualitzat al n√∫vol:", newXP, "nivell:", newLevel);
  } catch (err) {
    console.error("‚ùå Error actualitzant XP a Firestore:", err);
  }
}

// ‚ú® Modifica la funci√≥ addXP perqu√® actualitzi Firebase tamb√©
window.addXP = async function(amount) {
  xp += amount;
  const xpMax = level * 100;
  if (xp >= xpMax) {
    xp -= xpMax;
    level++;
    gainTitle(level);
  }

  localStorage.setItem("xp", xp);
  localStorage.setItem("level", level);

  alert(`üèÖ Has guanyat ${amount} XP! (Nivell actual: ${level})`);

  await updateXPInDB(xp, level);
};


</script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async
 src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>


</body> 
</html>





